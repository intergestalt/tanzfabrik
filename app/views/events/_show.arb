show_festival = nil if !defined? show_festival

# TODO: generalize this and put it into the event model
if (event.type_id == 5)
  events_of_types = Event.of_types([5]).sort_by{ |e| e.start_date }.select { |e| e.end_date > (Date.today.beginning_of_week - 2.week) }
  event_pos = events_of_types.index(event)
  unless event_pos.nil? # remove unless when queries are safe
    next_event = events_of_types[event_pos+1] if event_pos < events_of_types.length
    prev_event = events_of_types[event_pos-1] if event_pos > 0
  end
end

header :id => "headlines", :class => "headlines-event" do
  div :class => "before" do
    if event.type.name == "Performance-Projekt"
      a "<", :class => "previous", :rel => "prev", :href => event_path(prev_event) if prev_event
    end
  end
  div :class => "main" do
    div :class => "line1" do
      if event.type.name == "Workshop"
        h1 event.type.name, :class => "title"
        a ">" + t(:workshop_registration), :href => page_path("workshop_anmeldung"), :class => "registration"
      elsif event.type.name == "Performance-Projekt"
        h1 event.type.name, :class => "title"
        a ">", :class => "next", :rel => "next", :href => event_path(next_event) if next_event
      elsif event.type.name == "Profitraining"
        h1 event.type.name, :class => "title"        
      else
        h1 t(:programm_event_headline), :class => "title"
        a ">" + t(:tickets), :href => page_path("tickets"), :class => "registration"
      end
    end
  end
end

div :class => "row event single-event" do
  div :class => "basic" do 
    div :class => "content" do
      
      render :partial => "events/basic_info", :locals => {:event => event, :show_festival => show_festival}
      
      if admin_user_signed_in?
        div :class => "admin-only admin-nav" do
          a "> Dieses Ereignis bearbeiten", :href => edit_admin_event_path(event)
        end
      end

    end
  end

  div :class => "details" do
    div :class => "content" do

      render :partial => "events/details", :locals => {:event => event, :show_festival => show_festival}

    end    
  end
end