header :id => "headlines", :class => "headlines-kursplan" do
  div :class => "main" do
    div :class => "line1" do
      h1 :class => "title" do
        span editable page, :title
      end
    end
    div :class => "line2 open-close" do
      div :class => "open" do
        div editable page, :content, :type => "wysihtml5"
        div t(:close), :class => "close-trigger"
      end
      div :class => "closed open-trigger" do
        div "Wichtige Infos"
      end
    end    
    div :class => "line3" do
      ul do
        page.downloads.each do |download|        
          li do
            a download.description, :href => download.attachment.url
          end
        end
      end
    end      
  end
end

if params[:start_date]
  start_date = Date.parse(params[:start_date])
else 
  start_date = Date.today.beginning_of_week # gets current monday      
end

if admin_user_signed_in?
  div :class => "btn-group admin-only" do
    a "< " + t(:previous_week), :class => "btn btn-default", :href => (url_for :controller => 'pages', :action => 'show', :id => 'kursplan', :start_date => (start_date - 1.week).to_s) 
    a t(:next_week) + " >", :class => "btn btn-default", :href => (url_for :controller => 'pages', :action => 'show', :id => 'kursplan', :start_date => (start_date + 1.week).to_s)
  end
end

# loop over locations
Location.all.each do |location|
  #div do
  #  h2 location.name
  #  para location.address
  #end

  # get event details for this location
  events = location.events.of_types([3, 4, 5, 6])    
  render :partial => "/events/timetable", :locals => {:events => events, :start_date => start_date}
end