render "/pages/editable_content"

# TODO: get all weekdays from locale
days = I18n.t(:"date.day_names")

# loop over locations
Location.all.each do |location|
  div do
    h2 location.name
    para location.address

    # get event details for this location
    eds = location.event_details
                           
    table do

      # display table headers with weekdays
      tr do
        th "Zeit"
        days.each do |day|
          th day
        end
      end
            
      # group event details by time
      ed_by_time = eds.group_by {|ed| ed.time.strftime("%R")} # grouped by time

      # go through times
      ed_by_time.each do |time, eds_t|
        tr do
        
          # display time in first column
          td l eds_t.first.time, :format=>:hours_minutes

          # group events at this time by weekday
          ed_by_weekday = eds_t.group_by {|ed| ed.start_date.strftime("%u")} # group by weekday

          # loop over all weekdays and display events 
          days.each_with_index do |day, index|          
            td do
              if ed_by_weekday[index.to_s]
                ed_by_weekday[index.to_s].each do |ed_w|
                  a ed_w.event.title + " (" + "Studio " + ed_w.studio.name + ")", :href => event_path(ed_w.event) 
                end
                
              end
              
            end
          end
          
        end
      end
      
    end  
      
  end
end