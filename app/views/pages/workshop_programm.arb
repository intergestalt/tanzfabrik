header :id => "headlines", :class => "headlines-event" do
  div :class => "main" do
    div :class => "line1" do
      h1 editable(page, :title), :class => "title"
      a "> " + t(:workshop_registration), :href => page_path("workshop_anmeldung"), :class => "registration"
    end
    if page.content
      div :class => "line2 open-close opened" do
        div :class => "open" do
          div editable page, :content, :type => "wysihtml5"
          div t(:close), :class => "close-trigger"
        end
        div :class => "closed open-trigger" do
          div t :workshop_program_more
        end
      end
    end
    div :class => "line3" do
      ul do
        page.downloads.each do |download|        
          li do
            a download.description, :href => download.attachment.url
          end
        end
      end
    end
  end
end

if params[:year]
  start_date = Date.parse('01-01-' + params[:year])
  end_date = start_date.end_of_year
  workshops = Event.joins(:type, :event_details).where('event_types.id = 2 AND event_details.start_date >= ? AND event_details.start_date <= ?', start_date, end_date)
else 
  start_date = Date.today.beginning_of_month
  workshops = Event.joins(:type, :event_details).where('event_types.id = 2 AND event_details.start_date >= ?', start_date)
end

# get all workshops
#all_workshops = Event.where(:type_id => 2)

render :partial => "/events/workshop_list", :locals => {:workshops => workshops, :combinations => true}  

# figure out in which years event_details exist
years = Event.joins(:type, :event_details).where('event_types.id = 2').group_by_year(:start_date).count

# show links for these years
years.keys.each do |y|
  li do
    a "> " + t("workshop_list_all_in") + " " + y.year.to_s, :href => (url_for :controller => 'pages', :action => 'show', :id => 'workshop_programm', :year => y.year.to_s)
  end
end
