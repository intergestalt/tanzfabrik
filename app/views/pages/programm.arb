header :id => "headlines", :class => "headlines-event" do
  div :class => "main" do
    div :class => "line1" do
      h1 editable(page, :title), :class => "title"
      a "> " + t(:tickets), :href => page_path("tickets"), :class => "registration"
    end
    if page.content
      div :class => "line2 open-close opened" do
        div :class => "open" do
          div editable page, :content, :type => "wysihtml5"
          div t(:close), :class => "close-trigger"
        end
        div :class => "closed open-trigger" do
          div t :information_programm
        end
      end
    end    
    div :class => "line3" do
      ul do
        page.downloads.each do |download|        
          li do
            a download.description, :href => download.attachment.url
          end
        end
      end
    end          
  end
end


if params[:start_date]
  start_date = Date.parse(params[:start_date])
  final_date = start_date.end_of_month
else 
  start_date = Date.today.beginning_of_month
  final_date = Date.today + 6.month
end

para :class => "admin-only admin-nav" do
  a "<" + t(:previous_month), :href => (url_for :controller => 'pages', :action => 'show', :id => 'programm', :start_date => (start_date - 1.month).to_s)
  a t(:next_month) + ">", :href => (url_for :controller => 'pages', :action => 'show', :id => 'programm', :start_date => (start_date + 1.month).to_s)
end

# load events of types 1, 7, 8 or 9 that have a start_date earlier than the end of this month and an end_date later than the start of this month
events = Event.joins(:type, :event_details).where('(event_types.id = 1 OR event_types.id = 7 OR event_types.id = 8 OR event_types.id = 9) AND event_details.start_date <= ? AND event_details.end_date >= ?', final_date, start_date)
cache_arbre(self, cache_key_for_programm(events, start_date)) do
  render :partial => "/events/event_list", :locals => {:events => events, :start_date => start_date, :show_festival => true }  
end

